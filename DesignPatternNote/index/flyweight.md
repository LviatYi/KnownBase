# 13. 享元模式

## 13.1 模式动机

在某些场景中，对象的数量十分庞大，这将耗费大量的系统资源。当其中含有大量重复或相似对象时，可以利用享元模式进行优化。

享元模式通过共享技术实现相同或相似对象的重用。

## 13.2 模式定义

> **享元模式** (Flyweight Pattern) 又称为轻量级模式，它是一种对象结构性模式。  
>  
> - 运用共享技术有效地支持大量细粒度对象的复用。  
> - 系统只使用少量的对象，而这些对象都很相似，状态变化很小，可以实现对象的多次复用。  
> - 享元模式要求能够共享的对象必须是细粒度对象。

## 13.3 模式结构

享元模式常结合工厂模式使用。  

享元模式包含如下角色：  

- Flyweight 抽象享元类
  - 通常是一个接口或抽象类。  
  - 声明了具体享元类公共的方法。
    - 可提供享元对象的内部数据（内部状态）。  
    - 也可设置外部数据（外部状态）。  
- ConcreteFlyweight 具体享元类
  - 实现了抽象享元类，其实例称为享元对象。  
  - 为内部状态提供了存储空间。  
  - 通常可以结合单例模式来设计具体享元类，为每一个具体享元类提供唯一的享元对象。  
- UnsharedConcreteFlyweight 非共享具体享元类
  - 并不是所有的抽象享元类的子类都需要被共享，不能被共享的子类可设计为非共享具体享元类。  
  - 当需要时，可以直接通过实例化创建。
- FlyweightFactory 享元工厂类
  - 用于创建并管理享元对象。
  - 针对抽象享元类编程，将各种类型的具体享元对象存储在一个享元池中。  
    - 享元池一般设计为一个存储「键值对」的集合（也可以是其他类型的集合），可以结合工厂模式进行设计。  
    - 当用户请求一个具体享元对象时，享元工厂提供一个存储在享元池中已创建的实例或者创建一个新的实例（如果不存在的话），返回新创建的实例并将其存储在享元池中。

```PlantUML
@startuml Facade_ClassDiagram
hide empty members

class Client
class Facade
class SubSystemA
class SubSystemB
class SubSystemC

Client ..> Facade
Facade --> SubSystemA
Facade --> SubSystemB
Facade --> SubSystemC
@enduml
```

## 13.4 时序图

## 13.5 代码分析

## 13.6 模式分析

## 13.7 实例

## 13.8 优点

## 13.9 缺点

## 13.10 适用环境

## 13.11 模式应用

## 13.12 模式扩展
